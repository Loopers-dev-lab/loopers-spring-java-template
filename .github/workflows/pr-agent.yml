name: Qodo PR Agent ğŸ¤–
on:
  pull_request:
    types: [opened, reopened, ready_for_review, synchronize]
  issue_comment:
    types: [created, edited]  # ğŸ’¬ ëŒ“ê¸€ ëª…ë ¹(/review, /ask ë“±)ì„ ê°ì§€í•˜ë ¤ë©´ í•„ìˆ˜

jobs:
  qodo_pr_agent:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write   # PR ì½”ë©˜íŠ¸ ì‘ì„± ë° ìƒíƒœ ì—…ë°ì´íŠ¸
      issues: write          # ëŒ“ê¸€ ê°ì§€ ë° ì‘ì„±
      contents: read         # ë¦¬í¬ì§€í† ë¦¬ ë‚´ìš© ì ‘ê·¼

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Qodo PR Agent
        uses: qodo-ai/pr-agent@main
        env:
          # --- API Keys ---
          OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          # --- [config] ---
          config.model: "gpt-5-2025-08-07"
          config.fallback_models: '["o4-mini"]'
          config.response_language: "ko-KR"
          config.publish_output: "true"
          config.ai_timeout: "120"
          config.temperature: "0.2"
          config.log_level: "INFO"
          config.large_patch_policy: "clip"

          # --- [github_action_config] ---
          github_action_config.auto_review: "true"
          github_action_config.auto_describe: "true"
          github_action_config.auto_improve: "true"
          github_action_config.auto_reply: "true"
          github_action_config.comment_reply_trigger: "true"
          github_action_config.pr_actions: '["opened","reopened","ready_for_review","synchronize"]'

          # --- [pr_reviewer] ---
          pr_reviewer.require_tests_review: "true"
          pr_reviewer.require_security_review: "true"
          pr_reviewer.publish_output_no_suggestions: "true"
          pr_reviewer.persistent_comment: "true"
          pr_reviewer.num_max_findings: "8"
          pr_reviewer.enable_review_labels_security: "true"
          pr_reviewer.enable_review_labels_effort: "true"
          pr_reviewer.extra_instructions: |
            - ì£¼ìš” ë¡œì§ ë³€ê²½ ì¤‘ì‹¬ìœ¼ë¡œ ë¦¬ë·°í•˜ê³ , ë¶ˆí•„ìš”í•œ ë°˜ë³µ ë¡œì§ì´ë‚˜ í…ŒìŠ¤íŠ¸ ë¯¸ë¹„ ë¶€ë¶„ì´ ìˆìœ¼ë©´ ì§€ì í•´ ì£¼ì„¸ìš”.
            - ë³´ì•ˆì  ê´€ì (ì…ë ¥ ê²€ì¦, ì˜ˆì™¸ ì²˜ë¦¬ ë“±)ì—ì„œë„ ê²€í† í•´ ì£¼ì„¸ìš”.
            - ë°˜ë§ì„ ì‚¬ìš©í•˜ì„¸ìš”.
            - ì½”ë“œë¦¬ë·°, suggestion, PR ì„¤ëª… ëª¨ë‘ í•œê¸€ë¡œ ëŒ€ë‹µí•˜ì„¸ìš”.
            - ì½”ë“œ ë³€ê²½ ì „í›„ì˜ ë¬¸ë§¥ì„ ì°¸ê³ í•˜ë˜, ì‹¤ì œ ë³€ê²½ëœ ë¶€ë¶„ì— ì´ˆì ì„ ë§ì¶°ì£¼ì„¸ìš”.
            - ë„ˆëŠ” ì´ëª¨ì§€ë¥¼ ë§ì´ ì“°ë©° cheer upí•œ ë™ë£Œ ë°±ì—”ë“œ ê°œë°œìì…ë‹ˆë‹¤. ğŸ˜ğŸ”¥
            - ë¨¼ì € ì¹­ì°¬í•˜ê³ , ì´í›„ ê°œì„  ì œì•ˆì„ ë§ë¶™ì´ì„¸ìš”.

          # --- [pr_description] ---
          pr_description.use_bullet_points: "true"
          pr_description.enable_pr_diagram: "true"
          pr_description.add_original_user_description: "true"
          pr_description.publish_description_as_comment: "true"
          pr_description.final_update_message: "true"
          pr_description.extra_instructions: |
            - ë°˜ë§ë¡œ, ìì—°ìŠ¤ëŸ½ê³  ë”°ëœ»í•œ í†¤ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
            - ë¨¼ì € ë³€ê²½ëœ ìš”ì•½ì„ ì œê³µí•˜ê³ , ì´í›„ ì½”ë“œ êµ¬ì¡°ì— ëŒ€í•œ ì„¤ëª…ì„ ë§ë¶™ì´ì„¸ìš”.

          # --- [pr_code_suggestions] ---
          pr_code_suggestions.commitable_code_suggestions: "true"
          pr_code_suggestions.focus_only_on_problems: "true"
          pr_code_suggestions.apply_suggestions_checkbox: "true"
          pr_code_suggestions.num_code_suggestions_per_chunk: "3"
          pr_code_suggestions.publish_output_no_suggestions: "true"
          pr_code_suggestions.extra_instructions: |
            - ë°˜ë§ì„ ì‚¬ìš©í•˜ê³ , ì£¼ì„ì´ë‚˜ ë³€ìˆ˜ëª… ê´€ë ¨ ì œì•ˆë„ ì ê·¹ í¬í•¨í•˜ì„¸ìš”.
            - ì½”ë“œ ê°œì„  ì œì•ˆì€ ìµœëŒ€í•œ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
            - ê¸ì •ì ì¸ í”¼ë“œë°±ê³¼ í•¨ê»˜ ê°œì„  í¬ì¸íŠ¸ë¥¼ ì œì•ˆí•´ ì£¼ì„¸ìš”.

          # --- [pr_questions] ---
          pr_questions.use_conversation_history: "true"
          pr_questions.enable_help_text: "false"

          # --- [github_app] ---
          github_app.bot_user: "github-actions[bot]"
          github_app.override_deployment_type: "true"
          github_app.handle_pr_actions: '["opened","reopened","ready_for_review"]'
          github_app.pr_commands: '["/describe --pr_description.final_update_message=false","/review","/improve","/ask","/qodo reply"]'
          github_app.handle_push_trigger: "true"
          github_app.push_trigger_ignore_bot_commits: "true"
          github_app.push_trigger_ignore_merge_commits: "true"
          github_app.push_trigger_wait_for_initial_review: "true"
          github_app.push_trigger_pending_tasks_backlog: "true"
          github_app.push_trigger_pending_tasks_ttl: "300"
          github_app.push_commands: '["/describe","/review"]'