 01. Requirements

---

## Scope
도메인: 상품, 브랜드, 좋아요, 주문, 결제
---

## 기능 요구사항 (Happy Path)

### 상품

* 사용자는 상품 리스트 및 상세 정보를 조회할 수 있다.
* 기본 정렬은 인기순이며, 다양한 정렬 옵션이 제공된다.
* 상품 등록/수정은 판매자 권한 사용자만 가능하다.
* 상품 등록 시 다음 항목이 필요하다:
    * 상품명, 가격, 재고, 설명, 대표 이미지, 옵션 리스트(선택)
* 재고가 0이 되면 상태는 자동으로 품절로 전환된다.

### 브랜드
* 사용자는 브랜드 리스트와 상세 정보를 조회할 수 있다.
* 브랜드는 정렬(가나다순), 좋아요 여부로 필터링할 수 있다.
* 브랜드 상세에는 다음 항목이 포함된다:
    * 브랜드명, 소개글, SNS 링크, 관련 상품 리스트
* 사용자는 브랜드에 좋아요 등록/취소할 수 있다. (멱등 보장)

### 좋아요
* 상품과 브랜드에 대해 좋아요 등록/취소 기능이 제공된다.
* 같은 요청이 반복되어도 상태는 유지된다. (멱등성 보장)
* 요청 시 다음 항목이 포함되어야 한다:
    * 대상 ID (상품 or 브랜드), 사용자 ID

### 주문
* 사용자는 상품 상세에서 "주문하기"를 누르면 주문이 생성된다.
* 주문 시 다음 항목들을 검증한다:
    * 상품 유효성, 옵션 조합 유효성, 재고 수량
* 주문 생성 시 포함되는 항목:
    * 주문 번호(orderNumber), 주문 상태, 주문 시각, 주문자 ID, 주문 항목 리스트(OrderItem)
    * 각 OrderItem은 상품 ID, 옵션 ID, 수량으로 구성됨
* 주문 상태는 항상 "결제 대기"로 시작한다.
* 결제 성공 시 "결제 완료", 실패 시 "결제 실패"로 상태가 바뀐다.
* 결제 대기 상태인 주문만 사용자가 직접 취소할 수 있다.
* 주문 조회 시 반환 항목:
    * 주문 번호, 주문 시각, 상태, 결제 금액, 주문 항목 리스트, 각 상품 썸네일

### 결제

* 사용자는 결제 방법을 선택 후 결제를 진행할 수 있다.
* 결제 요청 시 포함 항목:
    * 주문 번호, 결제 방법, 사용 포인트(선택)
* 결제는 외부 PG사와 연동되며, callback API를 통해 완료 여부를 전달받는다.
* Callback 요청 항목:
    * 주문 번호, 결제 금액, 결제 성공 여부, 거래 고유 ID
* 결제 완료 시 포인트가 차감되고, 주문 상태가 갱신된다.
* Callback이 중복으로 들어오면 상태 체크 후 200 OK로 무시된다.
* 일정 시간이 지나도 callback이 오지 않으면 주문을 만료 처리한다.
* 결제 완료 시 주문 상세 정보가 리턴된다.

---

## Constraints

### 상품

* 상품명은 1\~100자 이내
* 이미지 최대 5개, 옵션 중복 불가, 가격 > 0, 재고 ≥ 0
* 정렬 기본값은 인기순, 최대 조회 개수 50
* 판매자 권한 필요

### 브랜드

* 비로그인 사용자는 좋아요 불가
* 삭제/비활성화 브랜드는 좋아요 불가
* 중복 좋아요/취소는 무시됨

### 주문

* 로그인 사용자만 생성/조회/취소 가능
* 삭제된 상품/옵션/재고 초과 등은 주문 불가
* 주문은 항상 "결제 대기" 상태로 생성됨
* 결제 완료 이후 취소는 환불 프로세스로 대체됨

### 결제

* 로그인 상태 필요
* 허용된 결제 방식만 가능 (ex. 카드, 포인트)
* 결제는 주문 상태가 "결제 대기"일 때만 가능
* 포인트는 결제 완료 시 차감됨
* 주문 정보와 Callback 데이터의 일치 여부 확인 필요 (위변조 방지)

---

## Fail Cases

### 인증 / 권한 오류

* 비로그인 상태에서 주문 생성, 조회, 좋아요, 결제 요청 → 401 Unauthorized
* 다른 사람의 주문 정보에 접근 시도 → 403 Forbidden

### 유효성 오류

* 삭제되거나 판매종료된 상품 → 400 Bad Request
* 존재하지 않는 옵션 조합 → 400 Bad Request
* 재고를 초과하거나 0 이하 수량 → 400 Bad Request
* 유효하지 않은 결제 방식 → 400 Bad Request
* 존재하지 않는 주문번호 → 404 Not Found
* 포인트 부족 → 400 Bad Request
* Callback 내 주문번호 불일치 or 금액 불일치 → 400 Bad Request

### 상태 제약 오류

* "결제 완료" 상태 주문을 취소 시도 → 409 Conflict
* "결제 대기"가 아닌 주문에 대해 결제 시도 → 400 Bad Request

### 시스템 오류

* 외부 PG사 통신 실패 → 502 Bad Gateway
* 일정 시간 내 Callback 미수신 → 결제 실패로 간주 → 주문 만료 처리

---

## 기타 고려사항

* Callback 위변조 방지: 시그니처/토큰 기반 유효성 검증 필요
* 주문 번호는 날짜 + 시퀀스 기반으로 생성됨
* 결제 실패 시 재시도 가능 (기존 주문 재사용 vs 새 주문 생성 고려 필요)

