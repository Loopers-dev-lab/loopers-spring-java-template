@startuml
'https://plantuml.com/sequence-diagram

autonumber

actor Client
participant BrandController
participant UserService
participant BrandFacade
participant BrandService
participant BrandRepository

Client -> BrandController : GET /api/v1/brands?sortBy=name&likedOnly=false

alt 인증 실패 (선택적 인증)
    BrandController -> UserService : validate(X-USER-ID)
    UserService --> BrandController : 401 Unauthorized
    BrandController --> Client : 401 Unauthorized
else 인증 성공 또는 비로그인
    alt 로그인 사용자
        BrandController -> UserService : validate(X-USER-ID)
        UserService --> BrandController : OK (userId 반환)
    end
    
    BrandController -> BrandFacade : 브랜드 목록 조회 요청(sortBy, likedOnly, userId)

    alt 좋아요한 브랜드만 조회 (likedOnly=true)
        BrandFacade -> BrandService : 사용자가 좋아요한 브랜드 조회
        BrandService -> BrandRepository : findLikedBrandsByUserId(userId)
        BrandRepository --> BrandService : 좋아요한 브랜드 목록
    else 전체 브랜드 조회 (likedOnly=false)
        BrandFacade -> BrandService : 전체 활성 브랜드 조회 (정렬)
        BrandService -> BrandRepository : findActiveByOrderBy(sortBy)
        BrandRepository --> BrandService : 활성 브랜드 목록
    end
    
    BrandService --> BrandFacade : 브랜드 목록 반환
    
    BrandFacade --> BrandController : BrandListResponse 생성
    
    BrandController --> Client : 200 OK + 브랜드 목록
end

note right of BrandController
응답 포함 항목:
- 브랜드 ID, 이름, 설명
- SNS 링크, 좋아요 수
- 관련 상품 수
- 좋아요 여부 (로그인 시)
end note

@enduml